name: Flutter Security Checks

on:
  workflow_call:

jobs:
  sast:
    name: SAST - Semgrep (Flutter)
    uses: ./.github/workflows/reusable-semgrep.yml
    with:
      additional_configs: '--config p/dart --config p/secrets --config p/owasp-top-ten'
      data_classification: 'PII (app-dependent)'
      privacy_impact: 'Review app data handling and secrets exposure'

  secrets-check:
    name: Flutter Secrets Check
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Check for hardcoded secrets (mobile)
        run: |
          echo "## ðŸ”‘ Secrets Detection" >> $GITHUB_STEP_SUMMARY
          if grep -rn "api[_-]key\|apikey\|secret\|password\|token" --include="*.dart" lib/ 2>/dev/null | grep -v "test\|mock\|example" | head -20; then
            echo "âš ï¸ Potential hardcoded secrets found - review required" >> $GITHUB_STEP_SUMMARY
          else
            echo "âœ… No obvious hardcoded secrets detected" >> $GITHUB_STEP_SUMMARY
          fi
        continue-on-error: true